
name: Build Texture Atlas

on:
  push:
    paths:
      - 'Images/**'
      - '.github/workflows/atlas.yml'
  workflow_dispatch:

jobs:
  pack-atlas:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup Java 17
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: 17

    - name: Download and run Unciv for atlas packing
      run: |
        wget -q -O Unciv.jar \
          $(curl -sL https://api.github.com/repos/yairm210/unciv/releases/latest \
            | grep -o "http.*Unciv.jar")
        java -jar Unciv.jar mod-ci

    - name: Commit and create PR if atlas changed
      uses: peter-evans/create-pull-request@v6
      with:
        commit-message: "ðŸ“¦ Rebuild texture atlas"
        title: "Rebuild texture atlas"
        body: |
          ÐŸÑ€Ð¸Ð²Ñ–Ñ‚!  
          Ð¯ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð¿ÐµÑ€ÐµÐ³ÐµÐ½ÐµÑ€ÑƒÐ²Ð°Ð² `game.png` Ñ‚Ð° `game.atlas` Ð² Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ– Ð·Ð¼Ñ–Ð½ Ñƒ Ð¿Ð°Ð¿Ñ†Ñ– `Images/`.
        paths: |
          Images/game.png
          Images/game.atlas
